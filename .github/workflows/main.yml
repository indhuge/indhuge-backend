on:
  workflow_dispatch:

jobs:
  deploy_on_ec2:
    name: Deploy on EC2
    runs-on: ubuntu-latest
    env:
      PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
      EC2_PUBLIC_IP: ${{ secrets.EC2_PUBLIC_IP }}
    steps:
    - name: Connect to EC2
      run: |
        echo "$PRIVATE_KEY" > private_key && chmod 600 private_key
        ssh -o StrictHostKeyChecking=no -i private_key ubuntu@${EC2_PUBLIC_IP} '
          sudo docker login -u ${{ secrets.DOCKER_USER }} -p ${{ secrets.DOCKER_PASSWORD }}
          cd indhuge-backend/prod
          sudo docker-compose down
          sudo docker-compose pull
          sudo docker-compose up -d'
